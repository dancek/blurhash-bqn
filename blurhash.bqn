c83 â† "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz#$%*+,-.:;=?@[]^_{|}~"
Base83 â† âŠâŸœc83âˆ˜{0:""; (ğ•ŠâŒŠğ•©Ã·83)âˆ¾83|ğ•©}
Base83Pad â† {
  s â† Base83ğ•©
  sâˆ¾Ëœ'0'â¥ŠËœğ•¨-â‰ s
}
DCT2d â† {
  s â† â‰¢ğ•©
  basis â† Ã—Â´Â¨ â€¢math.Cos Ï€Ã—ğ•¨âŠ¸Ã—Â¨Ã·âŸœsÂ¨â†•s
  Ã·âŸœ(Ã—Â´s)+Â´â¥ŠbasisÃ—ğ•©
}

Lin2srgb â† {
  ğ•©â‰¤0.0031308 ? âŒŠ0.5+12.92Ã—255Ã—0âŒˆğ•©;
  âŒŠ0.5+255Ã—0.055-Ëœ1.055Ã—(ğ•©âŒŠ1)â‹†Ã·2.4
}
Ac2ints â† {
  max â† âŒˆÂ´|â¥Šğ•©
  quant â† 0âŒˆ82âŒŠâŒŠÂ¯0.5+maxÃ—166
  norm â† 166Ã·Ëœ1+quant
  0âŒˆ18âŒŠâŒŠ9.5+9Ã—(Ã—Ã—â‹†âŸœ0.5âˆ˜|)(ğ•©Ã·norm)
}

img â† (4â€¿4â¥Š0)âˆ¾(16Ã·Ëœ4â€¿4â¥Šâ†•16)â‰(4â€¿4â¥Š1)
comps â† 2â€¿3 # yâ€¿x components

cs â† {â¥ŠDCT2dâŸœğ•©Â¨(â†•comps)}Ë˜ img
dc â† âŠË˜cs
ac â† 2Ã—1â†“Ë˜cs

c â† 1 Base83Pad +Â´9â€¿1Ã—comps-1
max â† âŒˆÂ´|â¥Šac
quant â† 0âŒˆ82âŒŠâŒŠÂ¯0.5+maxÃ—166
q â† 1 Base83Pad quant
a â† 4 Base83Pad +Â´(âŒ½256âŠ¸â‹†â†•3) Ã— Lin2srgbÂ¨ dc
d â† 2âŠ¸Base83PadÂ¨ +Ë(âŒ½19âŠ¸â‹†â†•3) Ã— Ac2ints ac
â€¢Out câˆ¾qâˆ¾aâˆ¾âˆ¾Â´d
