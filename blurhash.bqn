c83 â† "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz#$%*+,-.:;=?@[]^_{|}~"
Base83 â† âŠâŸœc83âˆ˜{0:""; (ğ•ŠâŒŠğ•©Ã·83)âˆ¾83|ğ•©}
Base83Pad â† {
  s â† Base83ğ•©
  sâˆ¾Ëœ'0'â¥ŠËœğ•¨-â‰ s
}
Base83dec â† {
  xs â† c83âŠğ•©
  +Â´xsÃ—âŒ½83â‹†â†•â‰ xs
}

DCT2d â† {
  s â† â‰¢ğ•©
  basis â† Ã—Â´Â¨ â€¢math.Cos Ï€Ã—ğ•¨âŠ¸Ã—Â¨Ã·âŸœsÂ¨â†•s
  Ã·âŸœ(Ã—Â´s)+Â´â¥ŠbasisÃ—ğ•©
}

Srgb2lin â† {
  u â† ğ•©Ã·255
  {uâ‰¤0.04045 ? uÃ—12.92;
  ((u+0.055)Ã·1.055)â‹†2.4}
}
Lin2srgb â† {
  ğ•©â‰¤0.0031308 ? âŒŠ0.5+12.92Ã—255Ã—0âŒˆğ•©;
  âŒŠ0.5+255Ã—0.055-Ëœ1.055Ã—(ğ•©âŒŠ1)â‹†Ã·2.4
}
Ac2ints â† {
  norm â† 166Ã·Ëœ1+ğ•¨
  0âŒˆ18âŒŠâŒŠ9.5+9Ã—(Ã—Ã—â‹†âŸœ0.5âˆ˜|)(ğ•©Ã·norm)
}

EncodeLinear â‡ {comps ğ•Š img:
  cs â† (â¥Šâ‰â†•comps) DCT2dâŒœ <Ë˜img

  dc â† âŠcs
  ac â† 2Ã—1â†“cs

  c â† 1 Base83Pad +Â´1â€¿9Ã—comps-1
  max â† âŒˆÂ´|â¥Šac
  quant â† 0âŒˆ82âŒŠâŒŠÂ¯0.5+maxÃ—166
  q â† 1 Base83Pad quant
  a â† 4 Base83Pad +Â´(âŒ½256âŠ¸â‹†â†•3) Ã— Lin2srgbÂ¨ dc
  d â† 2âŠ¸Base83PadÂ¨ +Ë(âŒ½19âŠ¸â‹†â†•3) Ã— â‰ quant Ac2ints ac
  câˆ¾qâˆ¾aâˆ¾âˆ¾Â´d
}
Encode â‡ {
  ğ•¨ EncodeLinear Srgb2linÂ¨ ğ•©
}

Decomp â† {ğ•¨|âŒŠ(ğ•¨â‹†âŒ½â†•3)Ã·Ëœğ•©}
DecodeLinear â‡ {wâ€¿h ğ•Š hash:
  xâ€¿y â† âŒŠ1+9(|âˆ¾Ã·Ëœ) Base83dec âŠ‘hash
  quant â† Base83dec 1âŠ‘hash
  max â† 166Ã·Ëœ1+quant
  dc â† Srgb2linÂ¨ 256 Decomp Base83dec 4â†‘2â†“hash
  ac â† maxÃ—(Ã—Ã—â‹†âŸœ2âˆ˜|)9Ã·Ëœ9-Ëœ 19 DecompË˜ Base83decË˜âˆ˜â€¿2â¥Š6â†“hash
  comps â† (â¥Šâ‰â†•xâ€¿y)âˆ¾Ë˜dcâˆ¾ac
  img â† +Ë>(<Ë˜comps){âŸ¨c,dâŸ©â€¿râ€¿gâ€¿b ğ•Š xâ€¿y:
    basis â† Ã—Â´â€¢math.Cos Ï€Ã—câ€¿dÃ—xâ€¿yÃ·wâ€¿h
    basisÃ—râ€¿gâ€¿b
  }âŒœâ†•wâ€¿h
  2â€¿0â€¿1â‰â¼img
}
Decode â‡ {Lin2srgbÂ¨ ğ•¨ DecodeLinear ğ•©}
